<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3tr-Perfumes</title>
    <link rel="icon" href="icon1.png" type="image/svg+xml">
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <!-- Firebase Analytics (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@500;700&display=swap');
        body {
            margin: 0;
            font-family: 'Teko', Arial, sans-serif;
            background: #faf9f6;
            color: #222;
            min-height: 100vh;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            padding: 0px;
            height: 54px;
            box-shadow: 0 2px 8px #e0e0e0;
        }
        #headerBar {
            background: #fff !important;
            box-shadow: 0 2px 8px #e0e0e0 !important;
        }
        .navbar .logo {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: #5a4e7c;
            display: flex;
            align-items: center;
            padding: 10px;
        }
        .navbar ul {
            display: flex;
            gap: 16px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .navbar li {
            cursor: pointer;
            font-size: 2.1rem;
            font-weight: bold;
            transition: color 0.2s;
            position: relative;
            padding: 0 10px 2px 10px;
        }
        .navbar li:hover, .navbar li.active {
            color: #af0ba7;
        }
        .navbar li::after {
            content: '';
            display: block;
            margin: 0 auto;
            margin-top: 4px;
            width: 28px;
            height: 4px;
            border-radius: 2px;
            background: transparent;
            transition: background 0.2s, width 0.2s;
        }
        .navbar li.active::after,
        .navbar li:hover::after {
            background: #eec9d2;
            width: 32px;
        }
        #searchBarContainer {
            margin-bottom: 0 !important;
        }
        #searchInput::placeholder {
            color: #bbb;
            opacity: 1;
        }
        #searchInput {
            background: #fff;
            color: #5a4e7c;
            border: 1.5px solid #eec9d2;
            box-shadow: 0 2px 8px #eec9d2;
            transition: box-shadow 0.2s, border 0.2s;
            margin-left: 10px;
        }
        #searchInput:focus {
            outline: none;
            border: 1.5px solid #b9b4e7;
            box-shadow: 0 0 0 2px #b9b4e733;
        }
        .container {
            max-width: 1100px;
            margin: 16px auto 0 auto;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px #e0e0e0;
            border: 1px solid #eec9d2;
        }
        .admin-login-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .admin-login-box {
            background: #fff;
            padding: 32px 28px;
            border-radius: 10px;
            box-shadow: 0 2px 16px #e0e0e0;
            min-width: 320px;
            text-align: center;
        }
        .admin-login-box h2 {
            margin-bottom: 18px;
            color: #5a4e7c;
            font-size: 2rem;
        }
        .admin-login-box input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1.1rem;
        }
        .admin-login-box button {
            background: #eec9d2;
            color: #fff;
            border: none;
            padding: 10px 30px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .admin-login-box .error {
            color: #ff4444;
            font-size: 1rem;
            margin-top: 8px;
        }
        .admin-panel {
            text-align: right;
        }
        .admin-panel h2 {
            color: #5a4e7c;
            margin-bottom: 18px;
        }
        .add-product-btn {
            background: #eec9d2 !important;
            color: #fff !important;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 18px;
        }
        .product-form {
            background: #ecf1eb;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 18px 20px;
            margin-bottom: 24px;
            direction: rtl;
        }
        .product-form label {
            display: block;
            margin: 10px 0 4px 0;
            font-size: 1.1rem;
        }
        .product-form input, .product-form textarea, .product-form select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .product-form input[type="file"] {
            background: #fff;
            color: #222;
        }
        .product-form button {
            background: #eec9d2;
            color: #fff;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }
        .products-list {
            margin-top: 30px;
        }
        .product-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 12px #e0e0e0;
            border: 1px solid #eec9d2;
            padding: 10px 20px;
            margin-bottom: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            position: relative;
        }
        .product-card img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #eec9d2;
            background: #fff;
        }
        .product-info {
            flex: 1;
        }
        .product-title {
            font-size: 1.5rem;
            color: #5a4e7c;
            margin-bottom: 6px;
        }
        .product-desc {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }
        .product-type {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 0;
        }
        .product-prices {
            font-size: 1.5rem;
            margin-bottom: 6px;
            font-weight: bold;
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-start;
            align-items: center;
            gap: 12px;
        }
        .product-prices del {
            color: #b45d8c;
            margin-right: 8px;
            margin-left: 0;
        }
        .product-actions {
            display: flex;
            flex-direction: row;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-top: 18px;
            position: static;
        }
        .product-actions button {
            background: none;
            color: #b45d8c;
            border: none;
            border-radius: 5px;
            padding: 4px 6px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
        }
        .product-actions button:hover {
            color: #fff;
            background: #b45d8c;
        }
        .section-title {
            font-size: 2rem;
            color: #5a4e7c;
            margin-bottom: 18px;
            text-align: center;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
        }
        .products-grid .product-card {
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            opacity: 0;
            transform: translateY(30px);
            animation: productFadeIn 0.35s cubic-bezier(.36,.07,.19,.97) forwards;
            animation-delay: var(--fade-delay, 0ms);
        }
        @keyframes productFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .products-grid .product-card img, .products-grid .img-slider {
            width: 180px !important;
            height: 180px !important;
            max-width: 100%;
            max-height: 100%;
        }
        @media (max-width: 700px) {
            .container { padding: 8px; }
            .navbar { flex-direction: column; height: auto; padding: 0 4px; }
            .navbar { font-size: 1.5rem; }
            .logo { font-size: 2.3rem !important; color: #5a4e7c !important; }
            .navbar ul { gap: 6px; }
            .navbar li { font-size: 1.5rem !important; padding: 0 6px 2px 6px; }
            #searchInput { font-size: 1.3rem !important; }
        }
        /* Splash Screen Animations */
        @keyframes shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-20px, 0) rotate(-10deg); }
            20% { transform: translate(20px, 0) rotate(10deg); }
            30% { transform: translate(-20px, 0) rotate(-10deg); }
            40% { transform: translate(20px, 0) rotate(10deg); }
            50% { transform: translate(-20px, 0) rotate(-10deg); }
            60% { transform: translate(20px, 0) rotate(10deg); }
            70% { transform: translate(-20px, 0) rotate(-10deg); }
            80% { transform: translate(-20px, 0) rotate(-10deg); }
            90% { transform: translate(20px, 0) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes dropDown {
            0% { transform: translateY(0); }
            80% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
        @keyframes shakeCart {
            0% { transform: translate(0, 0) rotate(0deg); }
            20% { transform: translate(-4px, 0) rotate(-8deg); }
            40% { transform: translate(4px, 0) rotate(8deg); }
            60% { transform: translate(-4px, 0) rotate(-8deg); }
            80% { transform: translate(4px, 0) rotate(8deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .shake-cart {
            animation: shakeCart 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }
        .add-to-cart-msg {
            position: fixed;
            top: 80px;
            right: 30px;
            background: #f346f3;
            color: #fff;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 14px 28px;
            border-radius: 10px;
            box-shadow: 0 2px 12px #e0e0e0;
            z-index: 99999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
        }
        .add-to-cart-msg.show {
            opacity: 1;
            transform: translateY(0);
        }
        #cartBtn svg circle {
            fill: #ec35e3 !important;
        }
        #cartBtn svg path {
            fill: #eec9d2 !important;
        }
        #favoritesBtn svg path {
            fill: #eec9d2 !important;
        }
        /* ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑÿ£ÿØŸÖŸÜ ŸÅŸä ÿßŸÑŸÜÿßÿ® ÿ®ÿßÿ± ÿ™ŸÖÿßŸÖŸãÿß */
        li#adminBtn[data-section="admin"] {
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            display: inline-block !important;
        }
        /* ÿ•ÿÆŸÅÿßÿ° ŸÜÿµ ŸÜŸàÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ (man, woman, offers) ŸÅŸä ŸÉÿßÿ±ÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ */
        .product-card .product-type {
            font-size: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            line-height: 0 !important;
        }
        .add-to-cart-btn {
            margin-top: 2px !important;
            background: #b9b4e7 !important;
            color: #fff !important;
            border: none;
        }
        .add-to-cart-btn:hover {
            background: #eec9d2 !important;
            color: #7c4e58 !important;
        }
        .add-product-btn, .order-status-select {
            background: #e6b400 !important;
            color: #fff !important;
            border: none;
        }
        .add-product-btn:hover, .order-status-select:hover {
            background: #fffbe6 !important;
            color: #b38f00 !important;
        }
        /* ÿ≠ÿØŸàÿØ ÿßŸÑŸÇŸÑÿ® ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä ÿØÿßŸÉŸÜ */
        #favoritesBtn svg path {
            stroke: #5a4e7c !important;
        }
        /* ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ŸÅŸàŸÇ ÿßŸÑŸÇŸÑÿ® ÿ£ÿ®Ÿäÿ∂ ÿ®ÿÆŸÑŸÅŸäÿ© ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä ŸÅÿßÿ™ÿ≠ */
        #favoritesCount {
            background: #b9b4e7 !important;
            color: #fff !important;
        }
         @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        /* ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ® ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßŸÑÿ© */
        .order-status-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 6px 28px 6px 8px !important;
            border-radius: 8px !important;
            font-weight: bold !important;
            border: 2px solid #ffb300 !important;
            background: #ffb300 !important;
            color: #222 !important;
            transition: background 0.2s, color 0.2s, border 0.2s;
            cursor: pointer;
            min-width: 120px;
            text-align: center;
        }
        .order-status-select.delivered {
            background: #25d366 !important;
            color: #fff !important;
            border-color: #25d366 !important;
        }
        .order-status-select.cancelled {
            background: #ff4444 !important;
            color: #fff !important;
            border-color: #ff4444 !important;
        }
        .order-status-select.pending {
            background: #ffb300 !important;
            color: #222 !important;
            border-color: #ffb300 !important;
        }
        /* --- ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¥ŸÉŸÑ ŸÅŸàÿ±ŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸÖÿπ Floating Label --- */
        .order-form-modern {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 22px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px #e0e0e0;
            padding: 32px 24px 24px 24px;
            position: relative;
        }
        .order-form-modern .form-group {
            direction: rtl;
            width: 103%;
            position: relative;
            margin-bottom: 0;
        }
        .order-form-modern input,
        .order-form-modern textarea {
            width: 95%;
            padding: 18px 12px 10px 12px;
            border: 1.5px solid #eec9d2;
            border-radius: 8px;
            font-size: 1.15rem;
            background: #faf9f6;
            color: #5a4e7c;
            outline: none;
            transition: border 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px #eec9d2;
        }
        .order-form-modern input:focus,
        .order-form-modern textarea:focus {
            border: 1.5px solid #b9b4e7;
            box-shadow: 0 0 0 2px #b9b4e733;
        }
        .order-form-modern label {
            position: absolute;

            top: 9px;
            right: 15px;
            background: transparent;
            color: #b9b4e7;
            font-size: 1.1rem;
            pointer-events: none;
            transition: 0.2s cubic-bezier(.36,.07,.19,.97);
            padding: 0 4px;
            z-index: 2;
        }
        .order-form-modern input:not(:placeholder-shown) + label,
        .order-form-modern input:focus + label,
        .order-form-modern textarea:not(:placeholder-shown) + label,
        .order-form-modern textarea:focus + label {
            top: -10px;
            right: 2px;
            font-size: 0.95rem;
            color: #a1589e;
            background: #fff;
            padding: 0 6px;
            border-radius: 6px;
        }
        .order-form-modern textarea {
            min-height: 60px;
            resize: vertical;
        }
        .order-form-modern button[type="submit"] {
            background: linear-gradient(90deg, #a1589e 0%, #eec9d2 100%);
            color: #fff;
            font-weight: bold;
            padding: 14px 0;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            box-shadow: 0 2px 8px #eec9d2;
            transition: background 0.2s, color 0.2s;
        }
        .order-form-modern button[type="submit"]:hover {
            background: linear-gradient(90deg, #eec9d2 0%, #a1589e 100%);
            color: #fff;
        }
        .order-form-modern .error-msg {
            color: #ff4444;
            font-size: 1rem;
            margin-top: 2px;
            margin-bottom: -10px;
            min-height: 18px;
        }
        .order-form-modern .success-msg {
            color: #25d366;
            font-size: 1rem;
            margin-top: 2px;
            margin-bottom: -10px;
            min-height: 18px;
        }
        .order-form-modern #orderTotalBox {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin: 8px 0 0 0;
        }
        /* ÿ≤ÿ± ÿπÿµÿ±Ÿä ŸÖŸàÿ≠ÿØ ŸÑŸÑŸÅŸàÿ±ŸÖ ŸàÿßŸÑÿ≥ŸÑÿ© */
        .btn-modern {
            background: linear-gradient(90deg, #a1589e 0%, #eec9d2 100%);
            color: #fff;
            font-weight: bold;
            padding: 14px 0;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            box-shadow: 0 2px 8px #eec9d2;
            transition: background 0.2s, color 0.2s;
            width: 100%;
            max-width: 320px;
        }
        .btn-modern:hover {
            background: linear-gradient(90deg, #eec9d2 0%, #a1589e 100%);
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen" style="position:fixed;z-index:20000;top:0;left:0;width:100vw;height:100vh;background:#faf9f6;display:flex;align-items:center;justify-content:center;flex-direction:column;transition:opacity 0.4s;">
        <img id="splashLogo" src="icon1.png" alt="Logo" style="width:120px;height:120px;" />
    </div>
    <!-- ŸÜŸáÿßŸäÿ© ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <div id="headerBar" style="position:sticky;top:0;z-index:10000;background:#fff;box-shadow:0 2px 8px #e0e0e0;">
        <div style="display:flex;flex-direction:column;align-items:stretch;">
            <!-- ÿ¥ÿ±Ÿäÿ∑ ŸÖÿßÿ±ŸÉŸä ŸÖÿ™ÿ≠ÿ±ŸÉ ÿ£ÿπŸÑŸâ ÿßŸÑŸÑŸàÿ¨Ÿà -->
            <div id="promoBar" style="width:100%;background:#784fe7;color:#fff;font-size:1.5rem;font-weight:bold;letter-spacing:2px;position:relative;overflow:hidden;height:34px;display:flex;align-items:center;justify-content:center;">
                <div style="white-space:nowrap;display:inline-block;animation:marquee 20s linear infinite;">
                    Buy <b style="color: #8f0794;">3</b> & Get <b style="color: #8f0794;">1</b> Free !! &nbsp; ‚Ä¢ &nbsp; Buy <b style="color: #8f0794;">5</b> & Get <b style="color: #8f0794;">2</b> Free !! &nbsp; ‚Ä¢ &nbsp; Buy <b style="color: #8f0794;">3</b> & Get <b style="color: #8f0794;">1</b> Free !! &nbsp; ‚Ä¢ &nbsp;Buy <b style="color: #8f0794;">5</b> & Get <b style="color: #8f0794;">2</b> Free !!
                </div>
            </div>
       
            <div style="width:100%;display:flex;justify-content:center;align-items:center;">
                <div class="logo" style="display:flex;justify-content:center;align-items:center;">
                    <img src="icon1.png" alt="ÿπÿ∑ÿ±" style="height:54px;width:auto;display:block;" />
                </div>
            </div>
            <div style="width:100%;display:flex;justify-content:center;align-items:center;margin:8px 0 0 0;gap:12px;">
                <div id="searchBarContainer" style="display:flex;justify-content:center;align-items:center;gap:12px;margin:0;">
                    <input  id="searchInput" type="text" placeholder=" Search for Perfume..üîç" 
                        style="width:60%;max-width:400px;padding:10px 16px;font-size:1.2rem;border-radius:8px;"/>
                    <button id="favoritesBtn" style="position:relative;background:none;border:none;cursor:pointer;outline:none;display:flex;align-items:center;margin-right:0px;">
                        <svg id="favoritesIcon" width="36" height="36" viewBox="0 0 24 24" fill="none">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                                stroke="#ffb300" stroke-width="2" fill="#232323"/>
                        </svg>
                        <span id="favoritesCount" style="position:absolute;top:0;right:0;background:#ffb300;color:#222;font-size:1rem;font-weight:bold;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;">0</span>
                    </button>
                    <button id="cartBtn" style="position:relative;background:none;border:none;cursor:pointer;outline:none;display:flex;align-items:center;margin-left:0px; margin-right: 10px;">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="36" height="36" fill="#fff"/>
                            <path d="M6 7h12l-1.5 9.5a2 2 0 0 1-2 1.5h-3a2 2 0 0 1-2-1.5L6 7z" stroke="#5a4e7c" stroke-width="2" fill="none"/>
                            <path d="M9 7V5a3 3 0 0 1 6 0v2" stroke="#5a4e7c" stroke-width="2" fill="none"/>
                            <circle cx="10.5" cy="19" r="1.2" fill="#b9b4e7"/>
                            <circle cx="15.5" cy="19" r="1.2" fill="#b9b4e7"/>
                        </svg>
                        <span id="cartCount" style="position:absolute;top:0;right:0;background:#ff4444;color:#fff;font-size:1rem;font-weight:bold;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;">0</span>
                    </button>
                </div>
            </div>
            <nav class="navbar" style="background:none;box-shadow:none;padding-bottom:0;justify-content:center;">
                <ul style="margin:0 auto;">
                    <li data-section="admin" id="adminBtn" title="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ"></li>
                    <li style="padding-top: 7px;" data-section="man" class="active">Man</li>
                    <li style="padding-top: 7px;" data-section="woman">Woman</li>
                    <li style="padding-top: 7px;" data-section="offers">Offers</li>
                </ul>
            </nav>
        </div>
    </div>
    <button id="scrollTopBtn" style="display:none;position:fixed;bottom:32px;right:16px;z-index:9999;background:#b9b4e7;border:none;border-radius:50%;width:54px;height:54px;box-shadow:0 2px 12px #e0e0e0;cursor:pointer;align-items:center;justify-content:center;transition:opacity 0.3s;">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="12" fill="#b9b4e7"/>
            <path d="M8 14l4-4 4 4" stroke="#5a4e7c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    <button id="whatsappBtn" style="display:flex;position:fixed;bottom:100px;right:16px;z-index:9999;background:#25d366;border:none;border-radius:50%;width:54px;height:54px;box-shadow:0 2px 12px #0007;cursor:pointer;align-items:center;justify-content:center;transition:opacity 0.3s;">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="16" cy="16" r="16" fill="#25d366"/>
            <path d="M23 16.5c0-4.142-3.358-7.5-7.5-7.5s-7.5 3.358-7.5 7.5c0 1.326.347 2.57.95 3.646L8 24l3.972-1.312A7.47 7.47 0 0 0 15.5 24c4.142 0 7.5-3.358 7.5-7.5zm-7.5 6.5c-1.13 0-2.19-.293-3.104-.805l-.221-.13-2.36.78.78-2.36-.13-.221A6.48 6.48 0 0 1 9 16.5c0-3.584 2.916-6.5 6.5-6.5s6.5 2.916 6.5 6.5-2.916 6.5-6.5 6.5zm3.35-4.05c-.184-.092-1.09-.537-1.257-.598-.168-.062-.29-.092-.413.092-.123.184-.474.598-.581.723-.107.123-.215.138-.399.046-.184-.092-.777-.286-1.48-.911-.545-.486-.913-1.086-1.02-1.27-.107-.184-.012-.283.08-.375.082-.081.184-.215.276-.323.092-.107.123-.184.184-.307.062-.123.031-.23-.016-.323-.046-.092-.414-1.07-.567-1.465-.153-.395-.299-.34-.413-.347-.107-.005-.23-.006-.353-.006-.123 0-.323.046-.492.23-.168.184-.638.573-.638 1.398 0 .825.573 1.623.653 1.739.08.115 1.127 1.72 2.73 2.347.382.132.68.211.914.27.384.092.734.079 1.011.048.308-.034.949-.388 1.084-.763.134-.375.134-.696.094-.763-.04-.067-.153-.107-.32-.184z" fill="#fff"/>
        </svg>
    </button>
    <div id="addToCartMsg" class="add-to-cart-msg"></div>
    <div class="container" id="mainContainer">
        <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ Ÿäÿ™ÿ∫Ÿäÿ± ŸáŸÜÿß -->
    </div>
    <div id="adminLoginModal" class="admin-login-modal" style="display:none;">
        <div class="admin-login-box">
            <h2>Admin Login</h2>
            <input type="text" id="adminUsername" placeholder="Username">
            <input type="password" id="adminPassword" placeholder="Password">
            <button id="adminLoginBtn">Login</button>
            <div class="error" id="adminLoginError"></div>
        </div>
    </div>
    <script>
        // --- Firebase config ---
        const firebaseConfig = {
            apiKey: "AIzaSyBQk84dO9eB39kQ5eQXqO7MbrBKHP1uWyQ",
            authDomain: "elfanan-supplements.firebaseapp.com",
            databaseURL: "https://elfanan-supplements-default-rtdb.firebaseio.com",
            projectId: "elfanan-supplements",
            storageBucket: "elfanan-supplements.firebasestorage.app",
            messagingSenderId: "373631110527",
            appId: "1:373631110527:web:321bf56dead7f4c3df5e4a",
            measurementId: "G-R3G7ZLEWEK"
        };
        firebase.initializeApp(firebaseConfig);
        if (firebase.analytics) firebase.analytics();
        const db = firebase.database();

        // --- ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ Firebase ---
        let products = [];
        let editingProductIndex = null;
        const productTypes = [
            {key: 'man', label: 'Man'},
            {key: 'woman', label: 'Woman'},
            {key: 'offers', label: 'Offers'}
        ];
        // --- ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ---
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]'); // [{name, type}]
        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        function isFavorite(prod) {
            return favorites.some(f => f.name === prod.name && f.type === prod.type);
        }
        function toggleFavorite(name, type) {
            const idx = favorites.findIndex(f => f.name === name && f.type === type);
            if(idx > -1) {
                favorites.splice(idx, 1);
            } else {
                favorites.push({name, type});
            }
            saveFavorites();
            updateFavoritesCount();
            const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section');
            // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ÿå ÿ≠ÿØÿ´Ÿáÿß ŸÅŸÇÿ∑ ŸàŸÑÿß ÿ™ÿ∞Ÿáÿ® ŸÑÿ£Ÿä ÿµŸÅÿ≠ÿ© ÿ£ÿÆÿ±Ÿâ
            if (activeSection === 'favorites' || document.getElementById('mainContainer')?.querySelector('.section-title')?.textContent === 'ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™') {
                renderFavoritesSection();
            } else {
                renderProductsSection(activeSection);
            }
        }
        function updateFavoritesCount() {
            const favCount = document.getElementById('favoritesCount');
            if(favCount) favCount.innerText = favorites.length;
        }
        updateFavoritesCount();
        // ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        function listenToProducts() {
            db.ref('gymProducts').on('value', snapshot => {
                const val = snapshot.val() || [];
                // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÉŸÉÿßÿ¶ŸÜ (ŸÖŸÅÿ™ÿßÿ≠ ÿ™ŸÑŸÇÿßÿ¶Ÿä)ÿå ÿ≠ŸàŸÑŸáÿß ŸÑŸÖÿµŸÅŸàŸÅÿ©
                if (!Array.isArray(val)) {
                    products = Object.values(val);
                } else {
                    products = val;
                }
                // ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section') || 'man';
                renderProductsSection(activeSection);
                // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜÿå ÿ≠ÿØÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                if (document.getElementById('adminProductsList')) renderAdminProductsList();
            });
        }
        listenToProducts();

        // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function saveProductsToDB() {
            db.ref('gymProducts').set(products);
        }

        // --- ÿ≥ŸÑÿßŸäÿØÿ± ÿßŸÑÿµŸàÿ± Ÿàÿ™ŸÉÿ®Ÿäÿ±Ÿáÿß ---
        function showImageModalForProduct(prod, startIdx = 0) {
            if (!prod.images || !prod.images.length) return;
            let currentIdx = startIdx;
            let modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = 0;
            modal.style.left = 0;
            modal.style.right = 0;
            modal.style.bottom = 0;
            modal.style.background = 'rgba(0,0,0,0.85)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = 99999;
            // ÿ®ŸÜÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇŸÑŸäÿ® ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿµŸàÿ±ÿ©
            let arrowsHtml = '';
            if (prod.images.length > 1) {
                arrowsHtml = `
                    <button id="prevImgBtn" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);background:#fff8;border:none;border-radius:50%;width:38px;height:38px;font-size:2rem;cursor:pointer;z-index:10;opacity:0.85;">‚Äπ</button>
                    <button id="nextImgBtn" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:#fff8;border:none;border-radius:50%;width:38px;height:38px;font-size:2rem;cursor:pointer;z-index:10;opacity:0.85;">‚Ä∫</button>
                `;
            }
            modal.innerHTML = `
                <div id="modalImageSlider" style="position:relative;display:flex;flex-direction:column;align-items:center;">
                    <button id="closeModalBtn" style="position:absolute;top:-30px;right:0;background:#fff;border:none;border-radius:50%;width:32px;height:32px;font-size:1.3rem;cursor:pointer;z-index:10;">√ó</button>
                    <div style="position:relative;display:flex;align-items:center;justify-content:center;">
                        <img id="modalImg" src="${prod.images[currentIdx]}" style="max-width:80vw;max-height:70vh;border-radius:12px;border:4px solid #ec35e3;box-shadow:0 2px 16px #0007;" />
                        ${arrowsHtml}
                    </div>
                    <div id="imgCounter" style="margin-top:18px;color:#fff;font-size:1.2rem;font-weight:bold;text-shadow:0 2px 8px #000;">${currentIdx+1}/${prod.images.length}</div>
                </div>
            `;
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸàÿ±ÿ© ÿ£Ÿà ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
            modal.onclick = function(e) {
                if (e.target === modal || e.target.id === 'closeModalBtn') document.body.removeChild(modal);
            };
            document.body.appendChild(modal);
            // ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇŸÑŸäÿ® ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿµŸàÿ±ÿ©
            if (prod.images.length > 1) {
                const updateImg = () => {
                    modal.querySelector('#modalImg').src = prod.images[currentIdx];
                    modal.querySelector('#imgCounter').innerText = `${currentIdx+1}/${prod.images.length}`;
                };
                modal.querySelector('#prevImgBtn').onclick = function(e) {
                    e.stopPropagation();
                    currentIdx = (currentIdx - 1 + prod.images.length) % prod.images.length;
                    updateImg();
                };
                modal.querySelector('#nextImgBtn').onclick = function(e) {
                    e.stopPropagation();
                    currentIdx = (currentIdx + 1) % prod.images.length;
                    updateImg();
                };
            }
        }
        // --- ÿ™ÿπÿØŸäŸÑ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ±ÿ© ---
        function renderProductsSection(typeKey) {
            const container = document.getElementById('mainContainer');
            const type = productTypes.find(t => t.key === typeKey);
            // ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿÆŸÅŸäÿ© ŸÅŸÇÿ∑ + ÿßŸÑÿ®ÿ≠ÿ´
            const searchTerm = (window.currentSearchTerm || '').toLowerCase();
            const filtered = products.filter(p => 
                p.type === typeKey && 
                !p.hidden &&
                (
                    !searchTerm ||
                    (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                    (p.desc && p.desc.toLowerCase().includes(searchTerm))
                )
            );
            let html = `<div class='section-title'>${type ? type.label : ''}</div>`;
            if(filtered.length === 0) {
                html += `<div style='text-align:center;'>No products in this section yet.</div>`;
            } else {
                html += `<div class='products-grid'>`;
                filtered.forEach((prod, idx) => {
                    const fadeDelay = idx * 60; // 60ms ŸÑŸÉŸÑ ÿ®ÿ∑ÿßŸÇÿ©
                    // ÿ≥ŸÑÿßŸäÿØÿ± ÿµŸàÿ±
                    let slider = '';
                    if(prod.images && prod.images.length > 1) {
                        slider = `
                        <div class='img-slider' style='position:relative;'>
                            <img src='${prod.images[0]}' class='slider-img' style='cursor:pointer;' onclick='window.showImageModalForProduct(products[${products.indexOf(prod)}],0)' data-slider-idx='0' data-prod-idx='${idx}'>
                            <button class='slider-btn left' onclick='event.stopPropagation();window.changeSlide(this,${idx},-1)' style='position:absolute;left:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Äπ</button>
                            <button class='slider-btn right' onclick='event.stopPropagation();window.changeSlide(this,${idx},1)' style='position:absolute;right:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Ä∫</button>
                        </div>`;
                    } else {
                        slider = `<img src='${prod.images[0] || ''}' style='cursor:pointer;' onclick='window.showImageModalForProduct(products[${products.indexOf(prod)}],0)'>`;
                    }
                    // ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿÆÿµŸÖ
                    let discount = getDiscountPercent(prod.priceBefore, prod.priceAfter);
                    let discountHtml = discount ? `<span style='background:#ff4444;color:#fff;padding:2px 8px;border-radius:6px;font-size:1rem;position:absolute;left:10px;top:10px;'>${discount}% OFF</span>` : '';
                    // ÿßŸÑŸÇŸÑÿ®
                    let fav = isFavorite(prod);
                    let heartBtn = `<button onclick='window.toggleFavorite("${prod.name.replace(/"/g, '&quot;')}", "${prod.type}")' style='position:absolute;top:6px;right:0;background:none;border:none;cursor:pointer;z-index:10;'>
                        <svg width='32' height='32' viewBox='0 0 24 24' fill='${fav ? "#ff4444" : "none"}' stroke='#ff4444' stroke-width='2'><path d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/></svg>
                    </button>`;
                    let availableHtml = (prod.available === false) ? `<div style='color:#ff4444;font-weight:bold;margin-top:6px;'>ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±</div>` : '';
                    html += `
                    <div class='product-card' style='overflow:visible; --fade-delay:${fadeDelay}ms;'>
                        <div style='position:relative;'>
                            ${slider}
                            ${heartBtn}
                            ${discountHtml}
                            ${availableHtml}
                        </div>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-type'>${type ? type.label : ''}</div>
                        <div class='product-prices'>
                            <del>${prod.priceBefore} L.E</del> <span>${prod.priceAfter} L.E</span>
                        </div>
                        ${(prod.available === false) ? '' : `<button class='add-to-cart-btn' onclick='addToCart(${JSON.stringify(prod)})' style='background:#25d366;color:#fff;font-weight:bold;padding:8px 0;border-radius:6px;width:100%;margin-top:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©</button>`}
                    </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }
        // --- ÿ≥ŸÑÿßŸäÿØÿ± ÿßŸÑÿµŸàÿ± ---
        window.changeSlide = function(btn, filteredIdx, dir) {
            // ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÉŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ≠ÿßŸÑŸäŸãÿß
            const section = document.querySelector('.navbar li.active').getAttribute('data-section');
            const searchTerm = (window.currentSearchTerm || '').toLowerCase();
            const filtered = products.filter(p => 
                p.type === section && 
                !p.hidden &&
                (
                    !searchTerm ||
                    (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                    (p.desc && p.desc.toLowerCase().includes(searchTerm))
                )
            );
            const prod = filtered[filteredIdx];
            let img = btn.parentElement.querySelector('.slider-img');
            let current = parseInt(img.getAttribute('data-slider-idx')) || 0;
            current = (current + dir + prod.images.length) % prod.images.length;
            img.src = prod.images[current];
            img.setAttribute('onclick', `showImageModal("${prod.images[current]}")`);
            img.setAttribute('data-slider-idx', current);
        }
        window.showImageModalForProduct = showImageModalForProduct;
        // --- ÿ≠ÿ≥ÿßÿ® ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿÆÿµŸÖ ---
        function getDiscountPercent(before, after) {
            before = parseFloat(before); after = parseFloat(after);
            if(!before || !after || after >= before) return '';
            return Math.round(100 * (before - after) / before);
        }
        // ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑÿ£ÿØŸÖŸÜ
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminLoginError').innerText = '';
            document.querySelector('.admin-login-box h2').innerText = 'Admin Login';
            document.getElementById('adminUsername').placeholder = 'Username';
            document.getElementById('adminPassword').placeholder = 'Password';
            document.getElementById('adminLoginBtn').innerText = 'Login';
        }
        function hideAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }
        document.getElementById('adminBtn').onclick = showAdminLogin;
        document.getElementById('adminLoginBtn').onclick = function() {
            const user = document.getElementById('adminUsername').value.trim();
            const pass = document.getElementById('adminPassword').value.trim();
            if(user === 'ahmed' && pass === '0000') {
                hideAdminLogin();
                renderAdminPanel();
            } else {
                document.getElementById('adminLoginError').innerText = 'Invalid login data';
            }
        };
        // ÿßÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨Ÿáÿß
        document.getElementById('adminLoginModal').onclick = function(e) {
            if(e.target === this) hideAdminLogin();
        };

        // ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ
        function renderAdminPanel() {
            const container = document.getElementById('mainContainer');
            container.style.maxWidth = '';
            container.style.width = '';
            container.style.minWidth = '';
            let html = `<div class='admin-panel'>
                <h2>Admin Panel</h2>
                <div style='display:flex;gap:10px;flex-wrap:wrap;margin-bottom:18px;'>
                    <button class='add-product-btn' onclick='showProductForm()'>+ Add New Product</button>
                    <button class='add-product-btn' style='background:#25d366;' onclick='renderOrdersList()'>ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</button>
                    <button class='add-product-btn' style='background:#007bff;' onclick='renderDiscountCodesPage()'>ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ</button>
                    <button class='add-product-btn' style='background:#ffb300;color:#222;' onclick='renderAnalysisPanel()'>Analysis</button>
                </div>
                <div id='analysisPanelContainer'></div>
                <div id='productFormContainer' style='background:#007bff;margin-right:10px;'></div>
                <div class='products-list' id='adminProductsList'></div>
            </div>`;
            container.innerHTML = html;
            renderAdminProductsList();
        // ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ
        function renderAnalysisPanel() {
            const analysisContainer = document.getElementById('analysisPanelContainer');
            if (!analysisContainer) return;
            // ŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            let html = `<div style='display:flex;gap:12px;align-items:center;margin-bottom:18px;flex-wrap:wrap;'>
                <label>ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ: <input type='date' id='analysisFromDate' style='padding:4px 8px;border-radius:6px;border:1px solid #ccc;'/></label>
                <label>ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ: <input type='date' id='analysisToDate' style='padding:4px 8px;border-radius:6px;border:1px solid #ccc;'/></label>
                <button onclick='updateAnalysisPanel()' style='background:#25d366;color:#fff;font-weight:bold;padding:6px 18px;border-radius:8px;font-size:1rem;cursor:pointer;border:none;'>ŸÅŸÑÿ™ÿ±ÿ©</button>
                <button onclick='clearAnalysisFilters()' style='background:#ff4444;color:#fff;font-weight:bold;padding:6px 18px;border-radius:8px;font-size:1rem;cursor:pointer;border:none;'>ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±</button>
            </div>`;
            html += `<div id='analysisStatsBoxes' style='display:flex;gap:18px;flex-wrap:wrap;'></div>`;
            analysisContainer.innerHTML = html;
            updateAnalysisPanel();
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ
        function updateAnalysisPanel() {
            const statsBoxes = document.getElementById('analysisStatsBoxes');
            if (!statsBoxes) return;
            // ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÖŸÜ ÿßŸÑŸÅŸÑÿßÿ™ÿ±
            let fromDate = document.getElementById('analysisFromDate')?.value;
            let toDate = document.getElementById('analysisToDate')?.value;
            let from = fromDate ? new Date(fromDate + 'T00:00:00') : null;
            let to = toDate ? new Date(toDate + 'T23:59:59') : null;

            // ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
            let manCount = products.filter(p => p.type === 'man' && !p.hidden).length;
            let womanCount = products.filter(p => p.type === 'woman' && !p.hidden).length;
            let totalProducts = manCount + womanCount;

            // ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ
            firebase.database().ref('discountCodes').once('value', snap => {
                const codes = Object.values(snap.val() || {});
                let discountCodesCount = codes.length;

                // ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                firebase.database().ref('orders').once('value', snap2 => {
                    const ordersArr = Object.values(snap2.val() || {});
                    // ŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
                    let filteredOrders = ordersArr;
                    if (from || to) {
                        filteredOrders = ordersArr.filter(order => {
                            if (!order.time) return false;
                            let orderDate = parseOrderDate(order.time);
                            if (!orderDate) return false;
                            if (from && orderDate < from) return false;
                            if (to && orderDate > to) return false;
                            return true;
                        });
                    }
                    let cancelled = filteredOrders.filter(o => o.status === 'ŸÖŸÑÿ∫Ÿä').length;
                    let pending = filteredOrders.filter(o => !o.status || o.status === 'ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±' || o.status === 'pending').length;
                    let delivered = filteredOrders.filter(o => o.status === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ').length;

                    // ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ±ÿ®ÿπÿßÿ™
                    let statsHtml = `
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#784fe7;font-weight:bold;'>ŸÖŸÜÿ™ÿ¨ÿßÿ™ Man</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#232323;'>${manCount}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#784fe7;font-weight:bold;'>ŸÖŸÜÿ™ÿ¨ÿßÿ™ Woman</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#232323;'>${womanCount}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#784fe7;font-weight:bold;'>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#232323;'>${totalProducts}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#25d366;font-weight:bold;'>ÿπÿØÿØ ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#25d366;'>${discountCodesCount}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#ff4444;font-weight:bold;'>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖŸÑÿ∫Ÿäÿ©</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#ff4444;'>${cancelled}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#ffb300;font-weight:bold;'>ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#ffb300;'>${pending}</div>
                        </div>
                        <div style='background:#fff;border-radius:12px;box-shadow:0 2px 8px #e0e0e0;padding:18px 24px;min-width:180px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;'>
                            <div style='font-size:1.2rem;color:#25d366;font-weight:bold;'>ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ</div>
                            <div style='font-size:2.1rem;font-weight:bold;color:#25d366;'>${delivered}</div>
                        </div>
                    `;
                    statsBoxes.innerHTML = statsHtml;
                });
            });
        }

        // ÿØÿßŸÑÿ© ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±
        function clearAnalysisFilters() {
            document.getElementById('analysisFromDate').value = '';
            document.getElementById('analysisToDate').value = '';
            updateAnalysisPanel();
        }

        // ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ŸàŸäŸÑ ŸÜÿµ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ•ŸÑŸâ ŸÉÿßÿ¶ŸÜ Date (ŸäÿØÿπŸÖ toLocaleString)
        function parseOrderDate(str) {
            // Ÿäÿ≠ÿßŸàŸÑ ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ
            // ŸäŸÇÿ®ŸÑ ÿµŸäÿ∫ ŸÖÿ´ŸÑ: 7/26/2025, 12:34:56 PM
            let d = new Date(str);
            if (!isNaN(d)) return d;
            // ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ÿ¨ÿ±ÿ® ÿ™ŸÇÿ≥ŸäŸÖ ÿßŸÑŸÜÿµ
            let parts = str.split(',');
            if (parts.length > 1) {
                let datePart = parts[0].trim();
                let timePart = parts[1].trim();
                let d2 = new Date(datePart + 'T' + timePart);
                if (!isNaN(d2)) return d2;
            }
            return null;
        }

        // ÿßÿ¨ÿπŸÑ ÿßŸÑÿØÿßŸÑÿ© ŸÖÿ™ÿßÿ≠ÿ© ÿπÿßŸÑŸÖŸäÿßŸã
        window.renderAnalysisPanel = renderAnalysisPanel;
        window.updateAnalysisPanel = updateAnalysisPanel;
        window.clearAnalysisFilters = clearAnalysisFilters;
        }

        // ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ŸÖŸÜÿ™ÿ¨
        function showProductForm(editIndex = null) {
            editingProductIndex = editIndex;
            let prod = {name:'', desc:'', images:[], priceBefore:'', priceAfter:'', type:productTypes[0].key, available:true};
            if(editIndex !== null) prod = products[editIndex];
            // ŸÖÿ™ÿ∫Ÿäÿ± ŸÑŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ŸÉŸÑ ÿßŸÑÿµŸàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸàÿßŸÑÿ¨ÿØŸäÿØÿ©
            let currentImages = prod.images ? [...prod.images] : [];
            let html = `<form  class='product-form' id='productForm'>
                <label>Product Name</label>
                <input type='text' name='name' value='${prod.name || ''}' required>
                <label>Description</label>
                <textarea name='desc' rows='2' required>${prod.desc || ''}</textarea>
                <label>Product Images</label>
                <input type='file' name='images' accept='image/*' multiple ${editIndex!==null?'':'required'}>
                <div id='previewImages' style='display:flex;gap:8px;margin-bottom:8px;'></div>
                <label>Price Before Discount</label>
                <input type='number' name='priceBefore' value='${prod.priceBefore || ''}' required>
                <label>Price After Discount</label>
                <input type='number' name='priceAfter' value='${prod.priceAfter || ''}' required>
                <label>Product Type</label>
                <select name='type'>
                    ${productTypes.map(t=>`<option value='${t.key}' ${prod.type===t.key?'selected':''}>${t.label}</option>`).join('')}
                </select>
                <label>ŸÖÿ™ŸàŸÅÿ±ÿü</label>
                <select name='available'>
                    <option value='true' ${prod.available!==false?'selected':''}>ŸÖÿ™ŸàŸÅÿ±</option>
                    <option value='false' ${prod.available===false?'selected':''}>ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±</option>
                </select>
                <button type='submit'>${editIndex!==null?'Edit Product':'Add Product'}</button>
                <button type='button' onclick='hideProductForm()' style='margin-right:10px;background:#333;color:#fff;'>Cancel</button>
            </form>`;
            document.getElementById('productFormContainer').innerHTML = html;
            // ÿπÿ±ÿ∂ ÿßŸÑÿµŸàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            if(currentImages.length) {
                showPreviewImages(currentImages);
            }
            // ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© Ÿàÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÑŸÑŸÇÿØŸäŸÖÿ©
            document.querySelector('#productForm input[name="images"]').onchange = function(e) {
                const files = Array.from(e.target.files);
                if(files.length) {
                    const readers = files.map(file => {
                        return new Promise(res => {
                            const reader = new FileReader();
                            reader.onload = ev => res(ev.target.result);
                            reader.readAsDataURL(file);
                        });
                    });
                    Promise.all(readers).then(imgs => {
                        currentImages = currentImages.concat(imgs);
                        showPreviewImages(currentImages);
                    });
                }
            };
            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
            document.getElementById('productForm').onsubmit = function(e) {
                e.preventDefault();
                const fd = new FormData(this);
                let newProd = {
                    name: fd.get('name'),
                    desc: fd.get('desc'),
                    images: currentImages,
                    priceBefore: fd.get('priceBefore'),
                    priceAfter: fd.get('priceAfter'),
                    type: fd.get('type'),
                    available: fd.get('available') === 'true'
                };
                saveProductData(newProd);
            };
        }
        function showPreviewImages(imgs) {
            const preview = document.getElementById('previewImages');
            preview.innerHTML = '';
            imgs.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.style.width = '50px';
                img.style.height = '50px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '5px';
                img.style.border = '1px solid #ffb300';
                preview.appendChild(img);
            });
        }
        function hideProductForm() {
            document.getElementById('productFormContainer').innerHTML = '';
        }
        function saveProductData(prod) {
            if(editingProductIndex !== null) {
                products[editingProductIndex] = prod;
                editingProductIndex = null;
            } else {
                products.push(prod);
            }
            saveProductsToDB();
            hideProductForm();
            renderAdminProductsList();
        }
        // ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ
        function renderAdminProductsList() {
            const list = document.getElementById('adminProductsList');
            if(!products.length) {
                list.innerHTML = '<div style="text-align:center;">No products yet.</div>';
                return;
            }
            let html = '';
            products.forEach((prod, i) => {
                const type = productTypes.find(t=>t.key===prod.type);
                let hideBtn = prod.hidden 
                    ? `<button title='ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='toggleHideProduct(${i})'>
                        <svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M1 12C2.73 7.61 7.09 4.5 12 4.5C16.91 4.5 21.27 7.61 23 12C21.27 16.39 16.91 19.5 12 19.5C7.09 19.5 2.73 16.39 1 12Z' stroke='#ffb300' stroke-width='2'/><circle cx='12' cy='12' r='3.5' stroke='#ffb300' stroke-width='2'/></svg>
                    </button>`
                    : `<button title='ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='toggleHideProduct(${i})'>
                        <svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M17.94 17.94C16.13 19.24 14.13 20 12 20C7.09 20 2.73 16.39 1 12C1.73 10.19 2.91 8.61 4.44 7.36M9.9 5.08C10.59 4.86 11.29 4.73 12 4.73C16.91 4.73 21.27 8.34 23 13C22.27 14.81 21.09 16.39 19.56 17.64M1 1L23 23' stroke='#ffb300' stroke-width='2'/><circle cx='12' cy='12' r='3.5' stroke='#ffb300' stroke-width='2'/></svg>
                    </button>`;
                html += `<div class='product-card' draggable='true' data-index='${i}'
                    ondragstart='onAdminProductDragStart(event, ${i})'
                    ondragover='onAdminProductDragOver(event, ${i})'
                    ondrop='onAdminProductDrop(event, ${i})'
                    ondragend='onAdminProductDragEnd(event)'
                    style='opacity:1;transition:opacity 0.2s;'>
                    <span class='drag-handle' style='cursor:grab;font-size:2rem;color:#ffb300;user-select:none;margin-right:8px;' title='ÿßÿ≥ÿ≠ÿ® ŸÑŸÑÿ™ÿ±ÿ™Ÿäÿ®'>‚ò∞</span>
                    <img src="${prod.images[0] || ''}" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨" style="cursor:pointer;" onclick="showImageModal('${prod.images[0]}')">
                    <div class='product-info'>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-prices'><del>${prod.priceBefore} L.E</del> <span>${prod.priceAfter} L.E</span></div>
                        <div class='product-actions'>
                            <button title='ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='editProduct(${i})'>
                                <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M4 21H20' stroke='#ffb300' stroke-width='2'/><path d='M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L7 20L2 21L3 16L18.5 2.5Z' stroke='#ffb300' stroke-width='2'/></svg>
                            </button>
                            <button title='ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨' onclick='deleteProduct(${i})'>
                                <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#ffb300' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#ffb300' stroke-width='2'/></svg>
                            </button>
                            ${hideBtn}
                        </div>
                    </div>
                </div>`;
            });
            list.innerHTML = html;
        }
        // --- Drag & Drop ŸÑŸÑÿ£ÿØŸÖŸÜ ---
        let dragSrcIndex = null;
        window.onAdminProductDragStart = function(e, idx) {
            dragSrcIndex = idx;
            e.dataTransfer.effectAllowed = 'move';
            e.currentTarget.style.opacity = '0.4';
        };
        window.onAdminProductDragOver = function(e, idx) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        };
        window.onAdminProductDrop = function(e, idx) {
            e.preventDefault();
            if (dragSrcIndex === null || dragSrcIndex === idx) return;
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
            const moved = products.splice(dragSrcIndex, 1)[0];
            products.splice(idx, 0, moved);
            dragSrcIndex = null;
            saveProductsToDB();
            renderAdminPanel();
        };
        window.onAdminProductDragEnd = function(e) {
            e.currentTarget.style.opacity = '1';
            dragSrcIndex = null;
        };
        // ÿ≤ÿ± ÿ•ÿÆŸÅÿßÿ°/ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨
        window.toggleHideProduct = function(i) {
            products[i].hidden = !products[i].hidden;
            saveProductsToDB();
            renderAdminProductsList();
        }
        // ÿ™ÿπÿØŸäŸÑ ŸÖŸÜÿ™ÿ¨
        window.editProduct = function(i) {
            showProductForm(i);
        }
        // ÿ≠ÿ∞ŸÅ ŸÖŸÜÿ™ÿ¨
        window.deleteProduct = function(i) {
            if(confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü')) {
                products.splice(i,1);
                saveProductsToDB();
                renderAdminProductsList();
            }
        }
        // ÿ±ÿ®ÿ∑ ÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑŸÜÿßÿ® ÿ®ÿßÿ±
        document.querySelectorAll('.navbar li[data-section]').forEach(li => {
            li.onclick = function() {
                document.querySelectorAll('.navbar li').forEach(l=>l.classList.remove('active'));
                this.classList.add('active');
                // ÿßŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÇÿ≥ŸÖ
                document.getElementById('searchInput').value = '';
                window.currentSearchTerm = '';
                const section = this.getAttribute('data-section');
                if(section === 'admin') {
                    showAdminLogin();
                } else {
                    renderProductsSection(section);
                }
            }
        });
        // ÿπÿ±ÿ∂ ŸÇÿ≥ŸÖ man ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿß
        renderProductsSection('man');
        // ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if(window.scrollY > navbar.offsetHeight + 30) {
                scrollTopBtn.style.display = 'flex';
                scrollTopBtn.style.opacity = '1';
            } else {
                scrollTopBtn.style.opacity = '0';
                setTimeout(()=>{scrollTopBtn.style.display = 'none';}, 300);
            }
        });
        scrollTopBtn.onclick = function() {
            window.scrollTo({top:0, behavior:'smooth'});
        }
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±
        window.currentSearchTerm = '';
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                window.currentSearchTerm = this.value;
                // ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                const activeSection = document.querySelector('.navbar li.active')?.getAttribute('data-section') || 'man';
                renderProductsSection(activeSection);
            });
        }
        // ÿ≤ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ® ÿßŸÑÿπÿßÿ¶ŸÖ
        const whatsappBtn = document.getElementById('whatsappBtn');
        if (whatsappBtn) {
            whatsappBtn.onclick = function() {
                window.open('https://wa.me/201159768514', '_blank');
            };
        }
    </script>
    <!-- Splash Screen Animation -->
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            const splash = document.getElementById('splashScreen');
            const logo = document.getElementById('splashLogo');
            if (splash && logo) {
                // Step 1: Shake
                logo.style.animation = 'shake 0.7s cubic-bezier(.36,.07,.19,.97) both';
                setTimeout(() => {
                    // Step 2: Drop Down
                    logo.style.animation = 'dropDown 0.9s cubic-bezier(.36,.07,.19,.97) forwards';
                    setTimeout(() => {
                        // Step 3: Hide splash and show page
                        splash.style.opacity = '0';
                        setTimeout(() => {
                            splash.style.display = 'none';
                        }, 400);
                    }, 900);
                }, 700);
            }
        });
    </script>
    <script>
        // --- ŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ≥ŸÑÿ© ---
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        let cartShakeInterval = null;
        function updateCartCount() {
            document.getElementById('cartCount').innerText = cart.length;
            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿßŸÑÿ≥ŸÑÿ© ŸÉŸÑ 3 ÿ´ŸàÿßŸÜŸä ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ≥ŸÑÿ© ÿ∫Ÿäÿ± ŸÅÿßÿ±ÿ∫ÿ©
            const cartBtn = document.getElementById('cartBtn');
            if(cart.length > 0) {
                if(!cartShakeInterval) {
                    cartShakeInterval = setInterval(() => {
                        if(cartBtn) {
                            cartBtn.classList.add('shake-cart');
                            setTimeout(()=>cartBtn.classList.remove('shake-cart'), 600);
                        }
                    }, 3000);
                }
            } else {
                if(cartShakeInterval) {
                    clearInterval(cartShakeInterval);
                    cartShakeInterval = null;
                }
            }
            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ© ŸÅŸä localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
        }
        function addToCart(prod) {
            // ÿ£ÿ∂ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÉŸÖÿß ŸáŸà (ÿ≠ÿ™Ÿâ ŸÑŸà ÿßŸÑÿßÿ≥ŸÖ ŸàÿßŸÑŸÜŸàÿπ ŸÖÿ™ŸÉÿ±ÿ±ŸäŸÜ)
            cart.push({ ...prod, qty: 1 });
            updateCartCount();
            // ÿ±ÿ≥ÿßŸÑÿ© ÿπÿßÿ¶ŸÖÿ©
            showAddToCartMessage(prod.name);
        }
        // ÿπÿ±ÿ∂ ÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ŸÑÿ©
        function renderCartPage() {
            const container = document.getElementById('mainContainer');
            if(cart.length === 0) {
                container.innerHTML = `<div class='section-title'>ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™</div><div style='text-align:center;'>. ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©</div>`;
                return;
            }
            let html = `<div class='section-title'>ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™</div><div class='products-list'>`;
            cart.forEach((item, i) => {
                html += `<div class='product-card' style='flex-direction:row;align-items:center;'>
                    <img src='${(item.images && item.images[0]) ? item.images[0] : ''}' style='width:80px;height:80px;object-fit:cover;border-radius:8px;margin-left:12px;'>
                    <div class='product-info' style='flex:1;'>
                        <div class='product-title'>${item.name}</div>
                        <div class='product-desc'>${item.desc}</div>
                        <div class='product-type'>${item.type}</div>
                        <div class='product-prices'><span>${item.priceAfter} L.E</span></div>
                    </div>
                    <div style='display:flex;flex-direction:column;align-items:center;gap:6px;'>
                        <button onclick='changeCartQty(${i},1)' style='background:#85f170;color:#ecf1eb;border:none;border-radius:50%;width:32px;height:32px;font-size:1.3rem;font-weight:bold;cursor:pointer;'>+</button>
                        <span style='font-size:1.2rem;font-weight:bold;'>${item.qty}</span>
                        <button onclick='changeCartQty(${i},-1)' style='background:#ff2a04;color:#ecf1eb;border:none;border-radius:50%;width:32px;height:32px;font-size:1.3rem;font-weight:bold;cursor:pointer;'>-</button>
                    </div>
                </div>`;
            });
            html += `</div>`;
            // ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿπÿ±
            let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
            html += `<div style='text-align:center;font-size:1.3rem;margin:18px 0;color:#ff2a04;'>L.E ${total}  <span style='color:#000000;;font-weight:bold;'> : ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿπÿ± </span></div>`;
            html += `<div style='text-align:center;'><button onclick='showOrderForm()' class='btn-modern'>ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®</button></div>`;
            container.innerHTML = html;
        }
        function changeCartQty(idx, delta) {
            cart[idx].qty += delta;
            if(cart[idx].qty <= 0) cart.splice(idx,1);
            updateCartCount();
            renderCartPage();
        }
        // ÿ≤ÿ± ÿßŸÑÿ≥ŸÑÿ©
        document.getElementById('cartBtn').onclick = renderCartPage;
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        updateCartCount();
        // --- ŸÅŸàÿ±ŸÖ ÿßŸÑÿ∑ŸÑÿ® ---
        function showOrderForm() {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®</div>
                <form id='orderForm' class='order-form-modern'>
                    <div class='form-group'>
                        <input type='text' name='name' id='orderName' placeholder=' ' required autocomplete='off'/>
                        <label for='orderName'>ÿßŸÑÿßÿ≥ŸÖ</label>
                    </div>
                    <div class='form-group'>
                        <input type='text' id='whatsappInput' name='whatsapp' placeholder=' ' required maxlength='11' pattern='[0-9]{11}' autocomplete='off'/>
                        <label for='whatsappInput'>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</label>
                        <div id='whatsappError' class='error-msg' style='display:none;'></div>
                    </div>
                    <div class='form-group'>
                        <textarea name='address' id='orderAddress' placeholder=' ' required></textarea>
                        <label for='orderAddress'>ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ</label>
                    </div>
                    <div class='form-group'>
                        <input type='text' id='discountCodeInput' name='discountCode' placeholder=' ' maxlength='6'/>
                        <label for='discountCodeInput'>ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿØ ÿÆÿµŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <div id='discountCodeMsg' class='success-msg' style='display:none;'></div>
                        <div id='discountCodeError' class='error-msg' style='display:none;'></div>
                    </div>
                    <div id='orderTotalBox'></div>
                    <button type='submit'>ÿ™ÿ£ŸÉŸäÿØ ŸÜŸáÿßÿ¶Ÿä ŸÑŸÑÿ∑ŸÑÿ®</button>
                </form>`;
            container.innerHTML = html;
            // ÿ™ÿ≠ŸÇŸÇ ŸÖÿ®ÿßÿ¥ÿ± ÿπŸÜÿØ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
            const whatsappInput = document.getElementById('whatsappInput');
            const whatsappError = document.getElementById('whatsappError');
            whatsappInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
                if(this.value.length > 11) this.value = this.value.slice(0,11);
                if(this.value.length === 11) {
                    whatsappError.style.display = 'none';
                }
            });
            // --- ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ---
            let discountValue = 0;
            let discountCodeUsed = '';
            const discountCodeInput = document.getElementById('discountCodeInput');
            const discountCodeMsg = document.getElementById('discountCodeMsg');
            const discountCodeError = document.getElementById('discountCodeError');
            const orderTotalBox = document.getElementById('orderTotalBox');
            function updateOrderTotal() {
                let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
                let afterDiscount = Math.max(0, total - discountValue);
                orderTotalBox.innerHTML = discountValue > 0
                    ? `ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿ®ÿπÿØ ÿßŸÑÿÆÿµŸÖ: <span style='color:#25d366;'>${afterDiscount} </span> <del style='color:#ff4444;font-size:1rem;margin-right:8px;'>${total} </del>`
                    : ` L.E ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿπÿ±: <span style='color:#ff2a04;'>${total}</span>`;
            }
            updateOrderTotal();
            discountCodeInput.addEventListener('input', function() {
                const code = this.value.trim().toUpperCase();
                discountCodeMsg.style.display = 'none';
                discountCodeError.style.display = 'none';
                discountValue = 0;
                discountCodeUsed = '';
                if(code.length === 6) {
                    firebase.database().ref('discountCodes/' + code).once('value', snap => {
                        if(!snap.exists()) {
                            discountCodeError.innerText = 'ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        const d = snap.val();
                        if(new Date(d.expires) < new Date()) {
                            discountCodeError.innerText = 'ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        if((d.usedCount || 0) >= (d.maxUses || 1)) {
                            discountCodeError.innerText = 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ ŸÖŸÜ ŸÇÿ®ŸÑ.';
                            discountCodeError.style.display = 'block';
                            updateOrderTotal();
                            return;
                        }
                        discountValue = parseFloat(d.amount);
                        discountCodeUsed = d.code;
                        discountCodeMsg.innerText = `ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ (${d.code}) Ÿàÿ™ŸÖ ÿÆÿµŸÖ ${d.amount} ÿ¨ŸÜŸäŸá.`;
                        discountCodeMsg.style.display = 'block';
                        updateOrderTotal();
                    });
                } else {
                    updateOrderTotal();
                }
            });
            // ---
            document.getElementById('orderForm').onsubmit = function(e) {
                e.preventDefault();
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®
                const val = whatsappInput.value;
                if(!/^[0-9]{11}$/.test(val)) {
                    whatsappError.innerText = 'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ® Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 11 ÿ±ŸÇŸÖŸãÿß (ÿ£ÿ±ŸÇÿßŸÖ ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ŸÅŸÇÿ∑)';
                    whatsappError.style.display = 'block';
                    whatsappInput.focus();
                    return;
                } else {
                    whatsappError.style.display = 'none';
                }
                const fd = new FormData(this);
                let total = cart.reduce((sum, item) => sum + (parseFloat(item.priceAfter) * (item.qty || 1)), 0);
                let afterDiscount = Math.max(0, total - discountValue);
                const order = {
                    name: fd.get('name'),
                    whatsapp: fd.get('whatsapp'),
                    address: fd.get('address'),
                    items: cart.map(item => ({...item})),
                    total: afterDiscount,
                    discountCode: discountCodeUsed || '',
                    discountValue: discountValue,
                    time: new Date().toLocaleString()
                };
                saveOrderToDB(order);
                // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉŸàÿØ ÿÆÿµŸÖÿå ÿ≤ÿØ usedCount ÿ®ŸÖŸÇÿØÿßÿ± 1
                if (discountCodeUsed) {
                    const codeRef = firebase.database().ref('discountCodes/' + discountCodeUsed + '/usedCount');
                    codeRef.transaction(current => (current || 0) + 1);
                }
                showOrderSummary(order);
                cart = [];
                updateCartCount();
            };
        }
        function showOrderSummary(order) {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠</div>`;
            
            html += `<div style='max-width:500px;margin:0 auto;background:#ecf1eb;padding:18px 20px;border-radius:10px; direction:rtl; font-size:1.4rem'>`;    
            html += `<div style='margin-bottom:10px; text-align:center; color:#a1589e;'><b>ÿ≥ŸàŸÅ Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÅŸä ÿßÿ≥ÿ±ÿπ ŸàŸÇÿ™ !!</b> </div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿßÿ≥ŸÖ:</b> ${order.name}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:</b> ${order.whatsapp}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿπŸÜŸàÿßŸÜ:</b> ${order.address}</div>`;
            html += `<div style='margin-bottom:10px;'><b>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</b> <span style='color:#ff2a04;'>${order.total} L.E</span></div>`;
            html += `<div style='margin-top:18px;text-align:center;'><button onclick='renderProductsSection("man")' style='background:#a1589e;color:#ffffff;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button></div>`;
            html += `</div>`;
            container.innerHTML = html;
        }
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function saveOrderToDB(order) {
            // ÿßÿ≥ÿ™ÿÆÿØŸÖ orders ŸÉÿ¨ÿ∞ÿ±
            const ordersRef = firebase.database().ref('orders');
            ordersRef.push(order);
        }
    </script>
    <script>
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿπÿßÿ¶ŸÖÿ© ÿ®ÿπÿØ addToCart ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        function showAddToCartMessage(productName) {
            const msg = document.getElementById('addToCartMsg');
            if(msg) {
                msg.innerText = ` ! ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ© "${productName}" ÿ™ŸÖ ÿßÿ∂ÿßŸÅÿ© `;
                msg.classList.add('show');
                clearTimeout(msg._hideTimeout);
                msg._hideTimeout = setTimeout(()=>msg.classList.remove('show'), 1500);
            }
        }
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ÿßŸÑÿ£ÿØŸÖŸÜ
        function renderOrdersList() {
            const container = document.getElementById('mainContainer');
            container.style.maxWidth = '90vw';
            container.style.width = '90vw';
            container.style.minWidth = '0';
            container.innerHTML = `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;'>
                <div class='section-title' style='margin-bottom:0;'>ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</div>
                <button onclick='renderAdminPanel()' style='background:#ffb300;color:#ffffff;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button>
            </div><div id='ordersList'></div>`;
            const ordersRef = firebase.database().ref('orders');
            // ÿßÿ≥ÿ™ÿÆÿØŸÖ on ÿ®ÿØŸÑÿßŸã ŸÖŸÜ once ŸÑÿ≥ÿ±ÿπÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
            ordersRef.on('value', snapshot => {
                const val = snapshot.val() || {};
                const orders = Object.entries(val); // [id, order]
                let html = '';
                if (!orders.length) {
                    html = '<div style="text-align:center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿ®ÿπÿØ.</div>';
                } else {
                    html = `<div style='overflow-x:auto;'><table style='width:100%;border-collapse:collapse;background:#232323;border-radius:10px;box-shadow:0 2px 12px #0003;'>
                        <thead>
                            <tr style='background:#181818;color:#ffb300;'>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿßÿ≥ŸÖ</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿπŸÜŸàÿßŸÜ</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ≠ÿ∞ŸÅ</th>
                            </tr>
                        </thead>
                        <tbody>`;
                    orders.reverse().forEach(([id, order]) => {
                        let productsHtml = '';
                        if(order.items && order.items.length) {
                            productsHtml = order.items.map(item => `
                                <div style='display:flex;align-items:center;gap:6px;margin-bottom:4px;'>
                                    <img src='${(item.images && item.images[0]) ? item.images[0] : ''}' style='width:38px;height:38px;object-fit:cover;border-radius:5px;border:1px solid #ffb300;'>
                                    <span style='font-size:1rem;color:#ffb300;font-weight:bold;'>${item.name}</span>
                                    <span style='font-size:0.95rem;color:#000000;'>√ó ${item.qty}</span>
                                </div>
                            `).join('');
                        }
                        html += `<tr style='border-bottom:1px solid #333;background-color:#ecf1eb;'>
                            <td style='padding:8px 6px;'>${order.name}</td>
                            <td style='padding:8px 6px;'>${order.whatsapp}</td>
                            <td style='padding:8px 6px;'>${order.address}</td>
                            <td style='padding:8px 6px;'>${productsHtml}</td>
                            <td style='padding:8px 6px;'>${order.discountCode ? `${order.discountCode} ${order.discountValue ? `(${order.discountValue} ÿ¨ŸÜŸäŸá)` : ''}` : ''}</td>
                            <td style='padding:8px 6px;color:#ffb300;font-weight:bold;'>${order.total} L.E</td>
                            <td style='padding:8px 6px;'>${order.time || ''}</td>
                            <td style='padding:8px 6px;'>
                                <select class='order-status-select' data-order-id='${id}' onchange='updateOrderStatus("${id}", this.value)' style='padding:4px 8px;border-radius:6px;font-size:1rem;background:#181818;color:#ffb300;border:1px solid #444;'>
                                    <option value='ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±' ${!order.status||order.status==='ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±'?'selected':''}>ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</option>
                                    <option value='ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ' ${order.status==='ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ'?'selected':''}>ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ</option>
                                    <option value='ŸÖŸÑÿ∫Ÿä' ${order.status==='ŸÖŸÑÿ∫Ÿä'?'selected':''}>ŸÖŸÑÿ∫Ÿä</option>
                                </select>
                            </td>
                            <td style='padding:8px 6px;text-align:center;'>
                                <button onclick='deleteOrder("${id}")' title='ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®' style='background:none;border:none;cursor:pointer;'>
                                    <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#ff4444' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#ff4444' stroke-width='2'/></svg>
                                </button>
                            </td>
                        </tr>`;
                    });
                    html += `</tbody></table></div>`;
                }
                document.getElementById('ordersList').innerHTML = html;
                styleOrderStatusSelects();
            });
        }
        // ÿØÿßŸÑÿ© ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®
        function deleteOrder(id) {
            if(confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü')) {
                firebase.database().ref('orders/' + id).remove();
            }
        }
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®
        function updateOrderStatus(id, status) {
            firebase.database().ref('orders/' + id + '/status').set(status);
            setTimeout(styleOrderStatusSelects, 100); // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸàŸÜ ÿ®ÿπÿØ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±
        }
        // ÿ£ÿ∂ŸÅ ÿØÿßŸÑÿ© ŸÑÿ™ŸÑŸàŸäŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßŸÑÿ©
        function styleOrderStatusSelects() {
            document.querySelectorAll('.order-status-select').forEach(sel => {
                sel.classList.remove('delivered', 'cancelled', 'pending');
                if(sel.value === 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ') {
                    sel.classList.add('delivered');
                } else if(sel.value === 'ŸÖŸÑÿ∫Ÿä') {
                    sel.classList.add('cancelled');
                } else {
                    sel.classList.add('pending');
                }
            });
        }
    </script>
     <style>
        h1{
            color: #222   ;
        }
     </style>
    <script>
        // --- ÿπÿ±ÿ∂ ŸÇÿ≥ŸÖ ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ---
        function renderFavoritesSection() {
            const container = document.getElementById('mainContainer');
            let html = `<div class='section-title'>ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™</div>`;
            if(favorites.length === 0) {
                html += `<div style='text-align:center;'>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©.</div>`;
            } else {
                html += `<div class='products-grid'>`;
                favorites.forEach((favItem, idx) => {
                    const prod = products.find(p => p.name === favItem.name && p.type === favItem.type);
                    if (!prod) return;
                    const fadeDelay = idx * 60;
                    let slider = '';
                    if(prod.images && prod.images.length > 1) {
                        slider = `
                        <div class='img-slider' style='position:relative;'>
                            <img src='${prod.images[0]}' class='slider-img' style='cursor:pointer; colo' onclick='showImageModal("${prod.images[0]}")' data-slider-idx='0' data-prod-idx='${idx}'>
                            <button class='slider-btn left' onclick='event.stopPropagation();window.changeSlide(this,${idx},-1)' style='position:absolute;left:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Äπ</button>
                            <button class='slider-btn right' onclick='event.stopPropagation();window.changeSlide(this,${idx},1)' style='position:absolute;right:2px;top:50%;transform:translateY(-50%);background:#222a;padding:2px 8px;border:none;color:#fc03efff;font-size:1.2rem;cursor:pointer;border-radius:4px;'>‚Ä∫</button>
                        </div>`;
                    } else {
                        slider = `<img src='${prod.images[0] || ''}' style='cursor:pointer;' onclick='showImageModal("${prod.images[0]}")'>`;
                    }
                    let fav = isFavorite(prod);
                    let heartBtn = `<button onclick='window.toggleFavorite("${prod.name.replace(/"/g, '&quot;')}", "${prod.type}")' style='position:absolute;top:6px;right:0;background:none;border:none;cursor:pointer;z-index:10;'>
                        <svg width='32' height='32' viewBox='0 0 24 24' fill='${fav ? "#ff4444" : "none"}' stroke='#ff4444' stroke-width='2'><path d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/></svg>
                    </button>`;
                    let availableHtml = (prod.available === false) ? `<div style='color:#ff4444;font-weight:bold;margin-top:6px;'>ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±</div>` : '';
                    html += `
                    <div class='product-card' style='overflow:visible; --fade-delay:${fadeDelay}ms;'>
                        <div style='position:relative;'>
                            ${slider}
                            ${heartBtn}
                            ${availableHtml}
                        </div>
                        <div class='product-title'>${prod.name}</div>
                        <div class='product-desc'>${prod.desc}</div>
                        <div class='product-type'>${prod.type}</div>
                        <div class='product-prices'>
                            <del>${prod.priceBefore} L.E</del> <span>${prod.priceAfter} L.E</span>
                        </div>
                        ${(prod.available === false) ? '' : `<button class='add-to-cart-btn' onclick='addToCart(${JSON.stringify(prod)})' style='background:#25d366;color:#fff;font-weight:bold;padding:8px 0;border-radius:6px;width:100%;margin-top:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©</button>`}
                    </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }
        // ÿ≤ÿ± ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™ ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ
        document.getElementById('favoritesBtn').onclick = function() {
            document.querySelectorAll('.navbar li').forEach(l=>l.classList.remove('active'));
            renderFavoritesSection();
        };
    </script>
    <script>
        // --- ÿµŸÅÿ≠ÿ© ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ ŸÅŸä ÿßŸÑÿ£ÿØŸÖŸÜ ---
        function renderDiscountCodesPage() {
            const container = document.getElementById('mainContainer');
            container.style.maxWidth = '90vw';
            container.style.width = '90vw';
            container.style.minWidth = '0';
            container.innerHTML = `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;'>
                <div class='section-title' style='margin-bottom:0;'>ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿÆÿµŸÖ</div>
                <button onclick='renderAdminPanel()' style='background:#ffb300;color:#222;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button>
            </div>
            <button onclick='showAddDiscountCodeForm()' style='background:#25d366;color:#fff;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;margin-bottom:18px;'>ÿ•ŸÜÿ¥ÿßÿ° ŸÉŸàÿØ ÿÆÿµŸÖ ÿ¨ÿØŸäÿØ</button>
            <div id='discountCodesFormContainer'></div>
            <div id='discountCodesList'></div>`;
            // ÿ¨ŸÑÿ® ÿßŸÑÿ£ŸÉŸàÿßÿØ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            firebase.database().ref('discountCodes').on('value', snapshot => {
                const val = snapshot.val() || {};
                const codes = Object.values(val).sort((a, b) => {
                    if (a.createdAt && b.createdAt) {
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                    return b.code.localeCompare(a.code);
                });
                let html = '';
                if (!codes.length) {
                    html = '<div style="text-align:center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ŸÉŸàÿßÿØ ÿÆÿµŸÖ ÿ®ÿπÿØ.</div>';
                } else {
                    html = `<div style='overflow-x:auto;'><table style='width:100%;border-collapse:collapse;background:#ecf1eb;border-radius:10px;box-shadow:0 2px 12px #0003;'>
                        <thead>
                            <tr style='background:#181818;color:#ffb300;'>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿßŸÑŸÉŸàÿØ</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ (ÿ¨ŸÜŸäŸá)</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°</th>
                                <th style='padding:10px 6px;border-bottom:2px solid #444;'>ÿ≠ÿ∞ŸÅ</th>
                            </tr>
                        </thead>
                        <tbody>`;
                    codes.forEach(code => {
                        let usageInfo = '';
                        const used = code.usedCount || 0;
                        const maxUses = code.maxUses || 1;
                        const remaining = maxUses - used;
                        // Always show usage info for all codes
                        let remainingColor = remaining === 0 ? '#ff4444' : (remaining < 3 ? '#ffb300' : '#25d366');
                        if (used > 0 || maxUses > 1) {
                            usageInfo = `<span style='color:#25d366;font-size:0.95em;margin-right:8px;'>ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ (${used})</span> - <span style='color:${remaining === 0 ? '#ff4444' : '#888'};font-size:0.95em;margin-right:4px;'>ŸÖÿ™ÿ®ŸÇŸä (${remaining})</span>`;
                        } else {
                            usageInfo = `<span style='color:${remaining === 0 ? '#ff4444' : '#888'};font-size:0.95em;margin-right:8px;'>ŸÖÿ™ÿ®ŸÇŸä (${remaining})</span>`;
                        }
                        html += `<tr style='border-bottom:1px solid #333;'>
                            <td style='padding:8px 6px;font-weight:bold;'>${code.code} ${usageInfo}</td>
                            <td style='padding:8px 6px;'>${code.amount} ÿ¨ŸÜŸäŸá</td>
                            <td style='padding:8px 6px;'>${code.expires ? new Date(code.expires).toLocaleString() : ''}</td>
                            <td style='padding:8px 6px;text-align:center;'>
                                <button onclick='deleteDiscountCode("${code.code}")' title='ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸàÿØ' style='background:none;border:none;cursor:pointer;'>
                                    <svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M3 6H5H21' stroke='#ff4444' stroke-width='2'/><path d='M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M10 11V17M14 11V17' stroke='#ff4444' stroke-width='2'/></svg>
                                </button>
                            </td>
                        </tr>`;
                    });
                    html += `</tbody></table></div>`;
                }
                var discountCodesList = document.getElementById('discountCodesList');
                if (discountCodesList) {
                    discountCodesList.innerHTML = html;
                }
            });
        }
        function showAddDiscountCodeForm() {
            document.getElementById('discountCodesFormContainer').innerHTML = `
                <form id='addDiscountCodeForm' style='background:#232323; color:red;padding:18px 20px;border-radius:10px;margin-bottom:18px;max-width:400px;'>
                    <label>ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ (6 ÿ£ÿ≠ÿ±ŸÅ ÿ£Ÿà ÿ£ÿ±ŸÇÿßŸÖ)</label>
                    <input type='text' name='code' maxlength='6' required pattern='[A-Za-z0-9]{6}' style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ (ÿ¨ŸÜŸäŸá)</label>
                    <input type='number' name='amount' min='1' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°</label>
                    <input type='datetime-local' name='expires' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <label>ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ</label>
                    <input type='number' name='maxUses' min='1' value='1' required style='width:100%;padding:8px;border-radius:6px;margin-bottom:10px;font-size:1.1rem;'>
                    <button type='submit' style='background:#ffb300;color:#222;font-weight:bold;padding:10px 24px;border-radius:8px;font-size:1.1rem;cursor:pointer;border:none;'>ÿ≠ŸÅÿ∏ ÿßŸÑŸÉŸàÿØ</button>
                    <button type='button' onclick='hideAddDiscountCodeForm()' style='margin-right:10px;background:#333;color:#fff;'>ÿ•ŸÑÿ∫ÿßÿ°</button>
                    <div id='discountCodeError' style='color:#ff4444;font-size:1rem;margin-top:8px;'></div>
                </form>`;
            document.getElementById('addDiscountCodeForm').onsubmit = function(e) {
                e.preventDefault();
                const fd = new FormData(this);
                const code = fd.get('code').toUpperCase();
                const amount = parseInt(fd.get('amount'));
                const expires = fd.get('expires');
                const maxUses = parseInt(fd.get('maxUses')) || 1;
                if(!/^[A-Za-z0-9]{6}$/.test(code)) {
                    document.getElementById('discountCodeError').innerText = 'ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿ£Ÿà ÿ£ÿ±ŸÇÿßŸÖ.';
                    return;
                }
                if(amount <= 0) {
                    document.getElementById('discountCodeError').innerText = 'ŸÇŸäŸÖÿ© ÿßŸÑÿÆÿµŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿµŸÅÿ±.';
                    return;
                }
                if(maxUses < 1) {
                    document.getElementById('discountCodeError').innerText = 'ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 1 ÿ£Ÿà ÿ£ŸÉÿ´ÿ±.';
                    return;
                }
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿ™ŸÉÿ±ÿßÿ± ÿßŸÑŸÉŸàÿØ
                firebase.database().ref('discountCodes/' + code).once('value', snap => {
                    if(snap.exists()) {
                        document.getElementById('discountCodeError').innerText = 'Ÿáÿ∞ÿß ÿßŸÑŸÉŸàÿØ ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ.';
                        return;
                    }
                    // ÿ≠ŸÅÿ∏ ÿßŸÑŸÉŸàÿØ
                    firebase.database().ref('discountCodes/' + code).set({
                        code,
                        amount,
                        expires,
                        maxUses,
                        usedCount: 0,
                        createdBy: 'admin',
                        createdAt: new Date().toISOString()
                    }, () => {
                        hideAddDiscountCodeForm();
                    });
                });
            };
        }
        function hideAddDiscountCodeForm() {
            document.getElementById('discountCodesFormContainer').innerHTML = '';
        }
        function deleteDiscountCode(code) {
            if(confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ŸÉŸàÿØ ÿßŸÑÿÆÿµŸÖÿü')) {
                firebase.database().ref('discountCodes/' + code).remove();
            }
        }
        window.renderDiscountCodesPage = renderDiscountCodesPage;
        window.deleteDiscountCode = deleteDiscountCode;
        window.showAddDiscountCodeForm = showAddDiscountCodeForm;
        window.hideAddDiscountCodeForm = hideAddDiscountCodeForm;
    </script>
    <!-- ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ŸÖÿ±ÿ™ŸäŸÜ ÿπŸÑŸâ ÿ¥ÿπÿßÿ± icon4.png ŸÅŸä ÿßŸÑŸáŸäÿØÿ±ÿå ÿßŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var logoImg = document.querySelector('.logo img');
            if (logoImg) {
                logoImg.ondblclick = function(e) {
                    if (typeof showAdminLogin === 'function') showAdminLogin();
                };
            }
        });
    </script>
</body>
</html>
